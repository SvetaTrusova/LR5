# Лабораторная работа 5

## Введение

1. Создание репозитория на GitHub:
   ![img.png](res/img.png)

2. Клонирование репозитория:

   Откроем терминал и перейдём в папку, где мы хотим сохранить локальную копию репозитория.
   Введём следующие команды, используя скопированный URL:

    ```
    git clone git@github.com:L33tl/git-lab5.git
    cd git-lab5
    ```
   ![img_2.png](res/img_2.png)


3. Добавление файла:

   Созддим новый текстовый файл, например, example.txt, и добавим в него какой-то текст, например, структуру книги (
   главы, параграфы...).
   Вернёмся в терминал и введём:

    ```
    git add example.txt
    git commit -m "File added example.txt"
    git push origin main
    ```
   ![img_3.png](res/img_3.png)

4. Создание ветки:

   Создадим новую ветку с названием, например, ```feature-branch```, и переключимся на нее:

    ```
    git branch feature-branch
    git checkout feature-branch
    ```
   ![img_4.png](res/img_4.png)


5. Отредактируем файл example.txt, добавив еще текст.

   Повторим шаги, указанные в п. 3.
   ![img_5.png](res/img_5.png)

6. Слияние изменений:

   Переключимся обратно в основную ветку:

    ```
    git checkout main
    ```
   Сольём изменения из ветки ```feature-branch``` в основную ветку:

    ```
    git merge feature-branch
    git push origin main
    ```
   ![img_6.png](res/img_6.png)

7. Завершение:

   Проверим, что изменения успешно слиты и отображаются в основной ветке на GitHub.
   Завершим работу с репозиторием.
   ![img_7.png](res/img_7.png)

## Работа с ветками

1. Создадим новый текстовый файл с базовой структурой книги, например:

```
# Название книги

## Глава 1: Введение
Здесь будет введение в тему книги.

## Глава 2: Основы Git
Основные понятия и команды Git.

```

![img_8.png](res/img_8.png)

2. Создадим ветку "feature-login" для разработки новой функциональности:

```
git checkout -b feature-login
```

![img_10.png](res/img_10.png)

3. Внесём изменения в файл:

```
# Название книги

## Глава 1: Введение
Здесь будет введение в тему книги.

## Глава 2: Основы Git
Основные понятия и команды Git.

## Глава 3: Вход в систему
Раздел по новой функциональности входа в систему.
```

4. Завершим изменения, закоммитим их и отправим ветку на GitHub:

```
git add README.md
git commit -m "Добавлена глава 3: Вход в систему"
git push origin feature-login
```

![img_9.png](res/img_9.png)

## Работа с удаленным репозиторием

1. Переключимся на основную ветку (main) и внесём изменения:

```
git checkout main
```

2. Внесём изменения в основной ветке (например, добавьте описание книги):

```
# Название книги: Приключения в мире Git

## Глава 1: Введение
Здесь будет введение в удивительный мир Git.

## Глава 2: Основы Git
Основные понятия и команды Git.

```

3. Закоммитим изменения и отправим их на GitHub:

```
git add <filename>
git commit -m "Изменено название книги и введение"
git push origin main
```

![img_11.png](res/img_11.png)

## Моделирование конфликта

1. Вернёмся в ветку "feature-login" и внесём изменения в том же участке:

```
git checkout feature-login
```

2. Изменим главу 2 в файле

```
# Название книги: Приключения в мире Git

## Глава 1: Введение
Здесь будет введение в удивительный мир Git.

## Глава 2: Основы Git и магия конфликтов
Основные понятия и команды Git, а также волшебство разрешения конфликтов.

```

3. Закоммитим изменения и отправим их на GitHub:

```
git add README.md
git commit -m "Добавлен раздел о магии конфликтов"
git push origin feature-login

```

![img_12.png](res/img_12.png)

## Разрешение конфликта

1. Вернёмся в основную ветку и попробуем слить изменения:

```
git checkout main
git pull origin main
```

2. Возникнет конфликт. Разрешим его в файле

```
# Название книги: Приключения в мире Git

## Глава 1: Введение
Здесь будет введение в удивительный мир Git.

<<<<<<< HEAD
## Глава 2: Основы Git и магия конфликтов
Основные понятия и команды Git, а также волшебство разрешения конфликтов.
======= 
## Глава 2: Основы Git
Основные понятия и команды Git. 
>>>>>>> feature-login

```

![img_13.png](res/img_13.png)

3. Разрешим конфликт, удалив метки и оставив нужные изменения:

```
# Название книги: Приключения в мире Git

## Глава 1: Введение
Здесь будет введение в удивительный мир Git.

## Глава 2: Основы Git и магия конфликтов
Основные понятия и команды Git, а также волшебство разрешения конфликтов.
```

4. Закоммитим разрешение конфликта и отправим изменения на GitHub:

```
git add README.md
git commit -m "Resolved conflict in chapter 2"
git push origin main
```

![img_14.png](res/img_14.png)

## Автоматизация проверки формата файлов при коммите

Хорошо, предположим, у нас есть задача автоматизировать проверку формата файлов при коммите с использованием Git Hooks.
Создадим простую задачу и решение для этого случая.

1. Задача

Перед каждым коммитом необходимо автоматически проверять, чтобы все .txt файлы в репозитории соответствовали
определенному формату.

2. Решение

* Создадим bash-скрипт (например, check_format.sh), который будет выполнять проверку формата .txt файлов. Этот скрипт
  может использовать инструменты, такие как grep или другие, чтобы проверить соответствие формату.

 ```sh
#!/bin/bash

staged_files=$(git diff --cached --name-only)

for file in $staged_files; do
  if [[ $file == *.txt ]]; then
    echo "Checking: $file - OK"
  else
    echo "Error $file if not a .txt file"
    exit 1
  fi
done

exit 0

````

* Добавление скрипта в репозиторий.
  Поместим скрипт в папку, например, в .git/hooks и назовём его pre-commit. Убедимся, что у него есть права на
  выполнение.

  ```
  cp check_format.sh .git/hooks/pre-commit
  chmod +x .git/hooks/pre-commit
  ```
  ![img_15.png](res/img_15.png)

* Попробуем внести изменения и закоммитить.

  Теперь, при каждой попытке закоммитить изменения, Git будет автоматически выполнять проверку формата файлов перед
  коммитом.

  ```
  git add .
  git commit -m "Добавлены изменения"
  ```
  ![img_16.png](res/img_16.png)

  ![img_17.png](res/img_17.png)

* Шаг 4: Решение конфликтов (если необходимо).

  Если нам необходимо внести изменения в файлы, чтобы они соответствовали формату, внесём изменения, добавим файлы и
  снова попробуем закоммитить.

## Использование Git Flow в проекте

Задача: интегрировать Git Flow в проект для управления циклом разработки, создания релизов и управления hotfixes.
Предположим, у нас есть задача на создание новой функциональности для нашего проекта с использованием Git Flow.
Рассмотрим конкретный пример.

1. Убедимся, что Git Flow установлен на локальной машине:

```
sudo apt-get install git-flow
```

![img_18.png](res/img_18.png)

2. В корне репозитория выполним инициализацию Git Flow.

```
git flow init
```

![img_20.png](res/img_20.png)

3. Создадим ветку для новой функциональности "task-management":

```
git flow feature start task-management
```

![img_19.png](res/img_19.png)

4. Внесём изменения в код для добавления функционала управления задачами (например, в файл task_manager.py):

```
def create_task(title, description):
    # Логика создания задачи
    print(f"Создана новая задача: {title}")
```

![img_21.png](res/img_21.png)

Выполним коммит изменения по мере разработки:

```
git add task_manager.py
git commit -m "Добавлен функционал управления задачами"
```

![img_22.png](res/img_22.png)

5. После завершения разработки функции завершим фичу и объединим ее с основной веткой:

```
git flow feature finish task-management
```

![img_23.png](res/img_23.png)

Git Flow автоматически переключится на ветку develop и выполнит слияние. Если есть конфликты, их нужно разрешить.

6. Переключимся на ветку "develop" и начнём создание релиза:

```
git checkout develop
git flow release start v1.0.0
```

![img_24.png](res/img_24.png)

7. Внесём изменения, связанные с релизом (например, обновим версию в файле version.txt):

```
echo "v1.0.0" > version.txt
git add version.txt
git commit -m "Обновлена версия для релиза v1.0.0"
```

![img_25.png](res/img_25.png)

8. Завершим релиз и объединим его с ветками "develop" и "main":

```
git flow release finish v1.0.0
```

![img_26.png](res/img_26.png)

9. Если в процессе использования выявлена критическая ошибка, создадим hotfix:

```
git flow hotfix start hotfix-1.0.1
```

![img_27.png](res/img_27.png)

10. Внесём изменения для исправления ошибки и закоммитим:

```
# Исправление ошибки
git add file_with_error.py
git commit -m "Исправлена критическая ошибка"
```

![img_28.png](res/img_28.png)

11. Завершим hotfix и объединим его с ветками "develop" и "main":

```
git flow hotfix finish hotfix-1.0.1
```

![img_29.png](res/img_29.png)

12. Завершение работы и отправка изменений на удаленный репозиторий. Отправьте изменения на удаленный репозиторий:

```
git push origin develop
git push origin main
```

![img_30.png](res/img_30.png)

## Ресурсы

1. [Git Documentation](https://git-scm.com/doc)
2. [Atlassian Git Tutorial](https://www.atlassian.com/git/tutorials)
3. [Pro Git Book](https://git-scm.com/book/en/v2)
4. [Markdown Guidelines](https://docs.github.com/ru/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax)
